@page
@model TGharker.Identity.Web.Pages.Dashboard.Settings.IndexModel
@{
    ViewData["Title"] = "Settings";
}

@if (!string.IsNullOrEmpty(Model.ErrorMessage))
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        @Model.ErrorMessage
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}

@if (!string.IsNullOrEmpty(Model.SuccessMessage))
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        @Model.SuccessMessage
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}

<div class="row">
    <div class="col-lg-8">
        <!-- Tenant Information -->
        <div class="card dashboard-card mb-4">
            <div class="card-header">
                <h5 class="card-title mb-0">Tenant Information</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label text-muted small">Tenant ID</label>
                        <div class="font-monospace">@Model.TenantId</div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label text-muted small">Identifier</label>
                        <div class="font-monospace">@Model.TenantIdentifier</div>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label text-muted small">Created</label>
                        <div>@Model.CreatedAt.ToString("MMMM d, yyyy 'at' h:mm tt")</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- General Settings -->
        <div class="card dashboard-card mb-4">
            <div class="card-header">
                <h5 class="card-title mb-0">General Settings</h5>
            </div>
            <div class="card-body">
                <form method="post" asp-page-handler="General">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label asp-for="GeneralSettings.Name" class="form-label">Tenant Name</label>
                            <input asp-for="GeneralSettings.Name" class="form-control" />
                            <span asp-validation-for="GeneralSettings.Name" class="text-danger"></span>
                            <div class="form-text">The display name for your tenant.</div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label asp-for="GeneralSettings.DisplayName" class="form-label">Display Name <span class="text-muted">(optional)</span></label>
                            <input asp-for="GeneralSettings.DisplayName" class="form-control" />
                            <span asp-validation-for="GeneralSettings.DisplayName" class="text-danger"></span>
                            <div class="form-text">A friendly name shown to users during login.</div>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">Save General Settings</button>
                </form>
            </div>
        </div>

        <!-- Security Settings -->
        <div class="card dashboard-card mb-4">
            <div class="card-header">
                <h5 class="card-title mb-0">Security Settings</h5>
            </div>
            <div class="card-body">
                <form method="post" asp-page-handler="Security">
                    <h6 class="text-muted mb-3">Token Lifetimes</h6>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label asp-for="SecuritySettings.AccessTokenLifetimeMinutes" class="form-label">Access Token Lifetime</label>
                            <div class="input-group">
                                <input asp-for="SecuritySettings.AccessTokenLifetimeMinutes" type="number" class="form-control" min="5" max="1440" />
                                <span class="input-group-text">minutes</span>
                            </div>
                            <span asp-validation-for="SecuritySettings.AccessTokenLifetimeMinutes" class="text-danger"></span>
                            <div class="form-text">How long access tokens remain valid (5-1440 min).</div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label asp-for="SecuritySettings.IdTokenLifetimeMinutes" class="form-label">ID Token Lifetime</label>
                            <div class="input-group">
                                <input asp-for="SecuritySettings.IdTokenLifetimeMinutes" type="number" class="form-control" min="5" max="1440" />
                                <span class="input-group-text">minutes</span>
                            </div>
                            <span asp-validation-for="SecuritySettings.IdTokenLifetimeMinutes" class="text-danger"></span>
                            <div class="form-text">How long ID tokens remain valid (5-1440 min).</div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label asp-for="SecuritySettings.RefreshTokenLifetimeDays" class="form-label">Refresh Token Lifetime</label>
                            <div class="input-group">
                                <input asp-for="SecuritySettings.RefreshTokenLifetimeDays" type="number" class="form-control" min="1" max="365" />
                                <span class="input-group-text">days</span>
                            </div>
                            <span asp-validation-for="SecuritySettings.RefreshTokenLifetimeDays" class="text-danger"></span>
                            <div class="form-text">How long refresh tokens remain valid (1-365 days).</div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label asp-for="SecuritySettings.AuthorizationCodeLifetimeMinutes" class="form-label">Authorization Code Lifetime</label>
                            <div class="input-group">
                                <input asp-for="SecuritySettings.AuthorizationCodeLifetimeMinutes" type="number" class="form-control" min="1" max="30" />
                                <span class="input-group-text">minutes</span>
                            </div>
                            <span asp-validation-for="SecuritySettings.AuthorizationCodeLifetimeMinutes" class="text-danger"></span>
                            <div class="form-text">How long auth codes remain valid (1-30 min).</div>
                        </div>
                    </div>

                    <hr class="my-4" />

                    <h6 class="text-muted mb-3">Security Options</h6>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="form-check form-switch">
                                <input asp-for="SecuritySettings.RequirePkce" class="form-check-input" type="checkbox" role="switch" />
                                <label asp-for="SecuritySettings.RequirePkce" class="form-check-label">Require PKCE</label>
                            </div>
                            <div class="form-text">Proof Key for Code Exchange adds security for public clients.</div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label asp-for="SecuritySettings.MaxLoginAttemptsPerMinute" class="form-label">Max Login Attempts</label>
                            <div class="input-group">
                                <input asp-for="SecuritySettings.MaxLoginAttemptsPerMinute" type="number" class="form-control" min="1" max="100" />
                                <span class="input-group-text">per minute</span>
                            </div>
                            <span asp-validation-for="SecuritySettings.MaxLoginAttemptsPerMinute" class="text-danger"></span>
                            <div class="form-text">Rate limit for login attempts per IP address.</div>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary">Save Security Settings</button>
                </form>
            </div>
        </div>
    </div>

    <div class="col-lg-4">
        <!-- Help Panel -->
        <div class="card dashboard-card">
            <div class="card-header">
                <h5 class="card-title mb-0"><i class="bi bi-info-circle me-2"></i>Help</h5>
            </div>
            <div class="card-body">
                <h6>Token Lifetimes</h6>
                <p class="small text-muted">
                    Shorter token lifetimes improve security but require more frequent re-authentication.
                    Balance security needs with user experience.
                </p>

                <h6>PKCE</h6>
                <p class="small text-muted">
                    PKCE (Proof Key for Code Exchange) is recommended for all OAuth clients,
                    especially single-page apps and mobile apps that cannot securely store secrets.
                </p>

                <h6>Rate Limiting</h6>
                <p class="small text-muted mb-0">
                    Login rate limiting helps protect against brute force attacks.
                    Set a reasonable limit based on your expected user traffic.
                </p>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}
